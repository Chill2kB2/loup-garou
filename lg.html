<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Loup-Garou (Multi)</title>
  <style>
    :root{
      --bg1:#07090d; --bg2:#0b1020;
      --panel:rgba(255,255,255,.06);
      --bd:rgba(255,255,255,.14);
      --txt:#eaeef7; --mut:rgba(234,238,247,.72);
      --acc:#7c5cff; --ok:#39d98a; --bad:#ff4d4d;
      --r:16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;color:var(--txt);font-family:system-ui,Segoe UI,Arial;
      min-height:100vh;
      background:
        radial-gradient(900px 500px at 20% 10%, rgba(124,92,255,.22), transparent 60%),
        radial-gradient(700px 500px at 80% 30%, rgba(57,217,138,.14), transparent 55%),
        radial-gradient(900px 650px at 50% 90%, rgba(255,255,255,.06), transparent 65%),
        linear-gradient(180deg,var(--bg1),var(--bg2));
    }
    .wrap{max-width:1120px;margin:0 auto;padding:18px}
    .top{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .h1{font-size:20px;font-weight:900;letter-spacing:.2px}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid var(--bd);border-radius:999px;background:rgba(255,255,255,.04)}
    .dot{width:10px;height:10px;border-radius:999px;background:rgba(234,238,247,.45)}
    .dot.ok{background:var(--ok)}
    .dot.bad{background:var(--bad)}
    .mut{color:var(--mut)}
    .small{font-size:12px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}
    @media (max-width:920px){ .grid{grid-template-columns:1fr} }
    .card{
      background:var(--panel);
      border:1px solid var(--bd);
      border-radius:var(--r);
      padding:14px;
      box-shadow:0 18px 60px rgba(0,0,0,.25);
    }
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .btn{
      border:1px solid var(--bd); background:rgba(255,255,255,.06); color:var(--txt);
      padding:10px 12px;border-radius:14px; cursor:pointer; font-weight:800;
    }
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .btn.acc{border-color:rgba(124,92,255,.55);background:rgba(124,92,255,.14)}
    .btn.bad{border-color:rgba(255,77,77,.55)}
    .in{border:1px solid var(--bd); background:rgba(255,255,255,.06); color:var(--txt); padding:10px 12px;border-radius:14px; outline:none;}
    .tag{font-size:12px;padding:4px 10px;border:1px solid var(--bd);border-radius:999px;color:var(--mut);background:rgba(255,255,255,.04)}
    .hr{height:1px;background:rgba(255,255,255,.12);margin:12px 0}

    .list{display:flex;flex-direction:column;gap:8px;margin-top:10px}
    .item{
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      padding:10px 12px;border:1px solid var(--bd);border-radius:14px;background:rgba(255,255,255,.03)
    }
    .alive{color:var(--ok);font-weight:900}
    .dead{color:var(--bad);font-weight:900}
    .timer{font-variant-numeric:tabular-nums;font-weight:900}
    .bigRole{
      font-size:22px;font-weight:950;letter-spacing:.2px;
      padding:10px 12px;border-radius:14px;border:1px solid rgba(124,92,255,.55);
      background:rgba(124,92,255,.12); display:inline-block;
    }
    .log{
      height:260px; overflow:auto; white-space:pre-wrap; word-break:break-word;
      padding:10px 12px;border-radius:14px;border:1px solid var(--bd);background:rgba(0,0,0,.18);
      font-size:13px;
    }

    .settingsBox{
      border:1px solid rgba(124,92,255,.35);
      background:rgba(124,92,255,.08);
      border-radius:14px;
      padding:12px;
    }
    .settingsGrid{
      display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px
    }
    @media (max-width:700px){ .settingsGrid{grid-template-columns:1fr} }
    .field label{display:block;font-size:12px;color:var(--mut);margin-bottom:6px}
    .field input, .field select{
      width:100%;
      border:1px solid var(--bd);
      background:rgba(255,255,255,.06);
      color:var(--txt);
      padding:10px 12px;
      border-radius:14px;
      outline:none;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="top">
      <div class="h1">Loup-Garou ‚Äî Lobby & Partie</div>
      <div class="pill">
        <span id="dot" class="dot bad"></span>
        <span id="status" class="mut">D√©connect√©</span>
      </div>
    </div>

    <div class="grid">
      <div class="card">
        <div class="row" style="justify-content:space-between">
          <div>
            <div><b>Connexion</b></div>
            <div class="small mut">Si ‚Äúconnecter‚Äù √©choue au 1er essai : retente une fois.</div>
          </div>
          <div class="small mut">WS: <span id="wsUrl"></span></div>
        </div>

        <div class="row" style="margin-top:10px">
          <input id="name" class="in" maxlength="18" placeholder="Ton nom (max 18)" />
          <button id="btnConnect" class="btn acc">Connecter</button>
          <button id="btnDisconnect" class="btn bad" disabled>D√©connecter</button>
          <button id="btnQuit" class="btn">Quitter (Accueil)</button>
        </div>

        <div class="hr"></div>

        <div class="row" style="justify-content:space-between">
          <div>
            <div><b>Partie</b></div>
            <div class="small mut">Phase: <span id="phase">‚Äî</span> ¬∑ Jour: <span id="day">‚Äî</span></div>
          </div>
          <div class="pill">
            <span class="mut">Temps:</span>
            <span id="timer" class="timer">‚Äî</span>
          </div>
        </div>

        <div class="row" style="margin-top:10px;justify-content:space-between">
          <div class="row">
            <div class="tag">Ton ID: <span id="myId">‚Äî</span></div>
            <div class="tag">H√¥te: <span id="hostId">‚Äî</span></div>
          </div>
          <div class="row">
            <button id="btnReady" class="btn" disabled>Pr√™t: OFF</button>
            <button id="btnStart" class="btn acc" disabled>D√©marrer (h√¥te)</button>
            <button id="btnBackLobby" class="btn" disabled>Retour Lobby (h√¥te)</button>
          </div>
        </div>

        <div class="hr"></div>

        <div>
          <div><b>Param√®tres de partie</b></div>
          <div id="settingsSummary" class="small mut" style="margin-top:6px">‚Äî</div>

          <div id="hostSettings" class="settingsBox" style="margin-top:10px; display:none">
            <div style="font-weight:900">Param√®tres (H√¥te)</div>
            <div class="small mut" style="margin-top:4px">
              Visible uniquement pour l‚Äôh√¥te quand tout le monde est pr√™t (‚â• 5). Appliqu√© au prochain d√©marrage.
            </div>

            <div class="settingsGrid">
              <div class="field">
                <label>Nombre de Loups-Garous</label>
                <select id="setWolves">
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                </select>
              </div>
              <div class="field">
                <label>Chasseur (ON/OFF)</label>
                <select id="setHunter">
                  <option value="1">ON</option>
                  <option value="0">OFF</option>
                </select>
              </div>

              <div class="field">
                <label>R√©v√©lation (secondes)</label>
                <input id="setReveal" type="number" min="5" max="40" step="1" />
              </div>
              <div class="field">
                <label>Nuit (secondes)</label>
                <input id="setNight" type="number" min="10" max="60" step="1" />
              </div>

              <div class="field">
                <label>Discussion (secondes)</label>
                <input id="setTalk" type="number" min="10" max="120" step="1" />
              </div>
              <div class="field">
                <label>Vote (secondes)</label>
                <input id="setVote" type="number" min="10" max="60" step="1" />
              </div>

              <div class="field">
                <label>Chasseur (tir) (secondes)</label>
                <input id="setHunterTime" type="number" min="8" max="45" step="1" />
              </div>
              <div class="field">
                <label>‚Äî</label>
                <div class="row">
                  <button id="btnApplySettings" class="btn acc">Appliquer</button>
                  <button id="btnDefaults" class="btn">D√©faut</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="hr"></div>

        <div>
          <div><b>Ton r√¥le</b></div>
          <div class="row" style="margin-top:8px;justify-content:space-between">
            <div id="roleBox" class="bigRole" style="display:none"></div>
            <div class="small mut">Envoy√© en ‚Äúprivate‚Äù au d√©marrage.</div>
          </div>
        </div>

        <div class="hr"></div>

        <div>
          <div><b>Actions</b></div>
          <div class="small mut">Les actions varient selon ton r√¥le et la phase.</div>
          <div id="actions" class="list"></div>
        </div>
      </div>

      <div class="card">
        <div class="row" style="justify-content:space-between">
          <div>
            <div><b>Joueurs</b></div>
            <div class="small mut">Min: <span id="minPlayers">5</span> ¬∑ Tous pr√™ts pour d√©marrer.</div>
          </div>
          <div class="tag">Pr√™ts: <span id="readyCount">0</span>/<span id="playerCount">0</span></div>
        </div>

        <div id="players" class="list"></div>

        <div class="hr"></div>

        <div class="row" style="justify-content:space-between">
          <div><b>Journal</b></div>
          <button id="btnClearLog" class="btn">Vider</button>
        </div>
        <div id="log" class="log" style="margin-top:10px"></div>
      </div>
    </div>
  </div>

<script>
(() => {
  const WS_URL = "wss://loup-garou-ws.onrender.com/ws";
  const el = (id) => document.getElementById(id);

  const dot = el("dot");
  const statusEl = el("status");
  const wsUrlEl = el("wsUrl");

  const nameEl = el("name");
  const btnConnect = el("btnConnect");
  const btnDisconnect = el("btnDisconnect");
  const btnQuit = el("btnQuit");

  const phaseEl = el("phase");
  const dayEl = el("day");
  const timerEl = el("timer");

  const myIdEl = el("myId");
  const hostIdEl = el("hostId");

  const btnReady = el("btnReady");
  const btnStart = el("btnStart");
  const btnBackLobby = el("btnBackLobby");

  const roleBox = el("roleBox");
  const actionsEl = el("actions");
  const playersEl = el("players");

  const logEl = el("log");
  const btnClearLog = el("btnClearLog");

  const settingsSummary = el("settingsSummary");
  const hostSettings = el("hostSettings");
  const setWolves = el("setWolves");
  const setHunter = el("setHunter");
  const setReveal = el("setReveal");
  const setNight = el("setNight");
  const setTalk = el("setTalk");
  const setVote = el("setVote");
  const setHunterTime = el("setHunterTime");
  const btnApplySettings = el("btnApplySettings");
  const btnDefaults = el("btnDefaults");

  const minPlayersEl = el("minPlayers");
  const readyCountEl = el("readyCount");
  const playerCountEl = el("playerCount");

  wsUrlEl.textContent = WS_URL;

  let ws = null;
  let myId = null;
  let isHost = false;
  let myRole = null;

  let lobby = null;
  let state = null;

  let timerEndAt = 0;
  let timerHandle = null;

  function setConn(ok, txt){
    dot.classList.toggle("ok", ok);
    dot.classList.toggle("bad", !ok);
    statusEl.textContent = txt;
  }

  function pushLog(text, emph=false){
    const t = new Date();
    const hh = String(t.getHours()).padStart(2,"0");
    const mm = String(t.getMinutes()).padStart(2,"0");
    const ss = String(t.getSeconds()).padStart(2,"0");
    const line = `[${hh}:${mm}:${ss}] ${text}`;
    logEl.textContent = (emph ? ("‚òÖ " + line) : line) + "\n" + logEl.textContent;
  }

  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, (m) => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
    }[m]));
  }

  function resetLocalState(){
    myId = null;
    isHost = false;
    myRole = null;
    lobby = null;
    state = null;
    roleBox.style.display = "none";
    roleBox.textContent = "";
    actionsEl.innerHTML = "";
    playersEl.innerHTML = "";
    settingsSummary.textContent = "‚Äî";
    hostSettings.style.display = "none";
    if (timerHandle) { clearInterval(timerHandle); timerHandle = null; }
    timerEl.textContent = "‚Äî";
  }

  function isMeAlive(){
    if (!state || !state.players || myId == null) return true;
    const me = state.players.find(x => x.id === myId);
    return me ? !!me.alive : true;
  }

  function setTimer(ms){
    timerEndAt = Date.now() + Math.max(0, ms || 0);
    if (timerHandle) clearInterval(timerHandle);
    timerHandle = setInterval(() => {
      const left = Math.max(0, timerEndAt - Date.now());
      const s = Math.ceil(left / 1000);
      timerEl.textContent = (state && state.phase !== "LOBBY" && state.phase !== "GAMEOVER") ? (s + "s") : "‚Äî";
      if (left <= 0) timerEl.textContent = (state && state.phase !== "LOBBY" && state.phase !== "GAMEOVER") ? "0s" : "‚Äî";
    }, 250);
  }

  function send(obj){
    if (!ws || ws.readyState !== 1) return;
    try { ws.send(JSON.stringify(obj)); } catch(e) {}
  }

  function renderTop(){
    phaseEl.textContent = state?.phase || lobby?.phase || "‚Äî";
    dayEl.textContent = state?.day ?? "‚Äî";

    myIdEl.textContent = (myId == null) ? "‚Äî" : String(myId);
    hostIdEl.textContent = lobby?.hostId ?? "‚Äî";

    btnDisconnect.disabled = !(ws && ws.readyState === 1);
    btnConnect.disabled = (ws && ws.readyState === 1);

    btnReady.disabled = !(ws && ws.readyState === 1);
    btnBackLobby.disabled = !(ws && ws.readyState === 1 && isHost);

    const allReady = !!lobby?.allReady;
    const inLobby = (lobby?.phase === "LOBBY");
    btnStart.disabled = !(ws && ws.readyState === 1 && isHost && inLobby && allReady);

    // Texte pr√™t
    if (lobby && myId != null){
      const me = lobby.players.find(x => x.id === myId);
      btnReady.textContent = "Pr√™t: " + (me?.ready ? "ON" : "OFF");
    } else {
      btnReady.textContent = "Pr√™t: OFF";
    }

    // R√¥le
    if (myRole){
      roleBox.style.display = "inline-block";
      roleBox.textContent = myRole;
    } else {
      roleBox.style.display = "none";
      roleBox.textContent = "";
    }

    // Compteurs pr√™t
    if (lobby){
      const pc = lobby.players.length;
      const rc = lobby.players.filter(p => p.ready).length;
      playerCountEl.textContent = String(pc);
      readyCountEl.textContent = String(rc);
      minPlayersEl.textContent = String(lobby.minPlayers || 5);
    } else {
      playerCountEl.textContent = "0";
      readyCountEl.textContent = "0";
      minPlayersEl.textContent = "5";
    }
  }

  function renderSettings(){
    if (!lobby || !lobby.settings){
      settingsSummary.textContent = "‚Äî";
      hostSettings.style.display = "none";
      return;
    }

    const s = lobby.settings;
    const revealS = Math.round((s.revealMs || 12000) / 1000);
    const nightS = Math.round((s.nightMs || 20000) / 1000);
    const talkS = Math.round((s.talkMs || 22000) / 1000);
    const voteS = Math.round((s.voteMs || 20000) / 1000);
    const hunterS = Math.round((s.hunterMs || 15000) / 1000);

    settingsSummary.textContent =
      `Loups: ${s.wolvesCount} ¬∑ Chasseur: ${s.hunterEnabled ? "ON" : "OFF"} ¬∑ ` +
      `R√©v√©lation: ${revealS}s ¬∑ Nuit: ${nightS}s ¬∑ Discussion: ${talkS}s ¬∑ Vote: ${voteS}s ¬∑ Tir: ${hunterS}s`;

    // Panneau host: uniquement si h√¥te + lobby + allReady
    const showHost = !!(isHost && lobby.phase === "LOBBY" && lobby.allReady);
    hostSettings.style.display = showHost ? "block" : "none";

    // Remplir inputs (sans spam)
    if (showHost){
      setWolves.value = String(s.wolvesCount || 1);
      setHunter.value = s.hunterEnabled ? "1" : "0";
      setReveal.value = String(revealS);
      setNight.value = String(nightS);
      setTalk.value = String(talkS);
      setVote.value = String(voteS);
      setHunterTime.value = String(hunterS);
    }
  }

  function renderActions(){
    actionsEl.innerHTML = "";
    if (!ws || ws.readyState !== 1){
      actionsEl.innerHTML = `<div class="item"><div><b>Non connect√©</b><div class="small mut">Entre ton nom puis clique Connecter.</div></div></div>`;
      return;
    }
    if (lobby?.phase === "LOBBY"){
      const txt = lobby.allReady
        ? "Tout le monde est pr√™t. L‚Äôh√¥te peut r√©gler les param√®tres puis d√©marrer."
        : "Mettez-vous pr√™ts (min 5).";
      actionsEl.innerHTML = `<div class="item"><div><b>Lobby</b><div class="small mut">${escapeHtml(txt)}</div></div></div>`;
      return;
    }
    if (!state) return;

    const aliveMe = isMeAlive();
    const ph = state.phase;

    const add = (t, sub) => {
      const row = document.createElement("div");
      row.className = "item";
      row.innerHTML = `<div><b>${escapeHtml(t)}</b><div class="small mut">${escapeHtml(sub||"")}</div></div>`;
      actionsEl.appendChild(row);
    };

    if (ph === "REVEAL"){ add("R√©v√©lation", "M√©morise ton r√¥le. La nuit arrive."); return; }

    if (ph === "NIGHT"){
      if (!aliveMe){ add("Nuit", "Tu es mort. Tu observes."); return; }
      if (myRole === "Loup-Garou") add("Nuit (Loup-Garou)", "Choisis une cible dans la liste (bouton Cibler).");
      else add("Nuit", "Tu attends. Les loups agissent.");
      return;
    }

    if (ph === "DAY_TALK"){ add("Jour", "Discussion. Le vote arrive."); return; }

    if (ph === "DAY_VOTE"){
      if (!aliveMe){ add("Vote", "Tu es mort. Tu ne votes pas."); return; }
      add("Vote", "Vote un joueur vivant (bouton Voter).");
      return;
    }

    if (ph === "HUNTER_SHOT"){
      if (myId === state.hunterShooterId) add("Chasseur", "Tire une derni√®re fois (bouton Tirer).");
      else add("Chasseur", "Le chasseur d√©cide‚Ä¶");
      return;
    }

    if (ph === "GAMEOVER"){ add("Fin", "L‚Äôh√¥te peut faire Retour Lobby pour relancer."); return; }
  }

  function renderPlayers(){
    playersEl.innerHTML = "";
    if (!lobby && !state) return;

    const players = (state?.players) ? state.players : (lobby?.players || []);
    for (const p of players){
      const row = document.createElement("div");
      row.className = "item";

      const alive = (p.alive === undefined) ? true : !!p.alive;
      const aliveTxt = alive ? `<span class="alive">Vivant</span>` : `<span class="dead">Mort</span>`;
      const readyTxt = (p.ready === undefined) ? "" : (p.ready ? "‚úÖ Pr√™t" : "‚è≥ Pas pr√™t");
      const hostTxt = (lobby && p.id === lobby.hostId) ? "üëë H√¥te" : "";

      const left = document.createElement("div");
      left.innerHTML = `
        <div><b>${escapeHtml(p.name || ("Joueur " + p.id))}</b> <span class="tag">#${p.id}</span></div>
        <div class="small mut">${hostTxt} ${readyTxt} ${state ? ("¬∑ " + aliveTxt) : ""}</div>
      `;

      const right = document.createElement("div");
      if (ws && ws.readyState === 1 && state && state.phase){
        const phase = state.phase;
        const aliveMe = isMeAlive();
        const isSelf = (p.id === myId);

        if (phase === "NIGHT" && myRole === "Loup-Garou" && aliveMe && !isSelf && (p.alive !== false)){
          const b = document.createElement("button");
          b.className = "btn";
          b.textContent = "Cibler";
          b.onclick = () => send({ t:"wolfKill", targetId: p.id });
          right.appendChild(b);
        }

        if (phase === "DAY_VOTE" && aliveMe && !isSelf && (p.alive !== false)){
          const b = document.createElement("button");
          b.className = "btn";
          b.textContent = "Voter";
          b.onclick = () => send({ t:"vote", targetId: p.id });
          right.appendChild(b);
        }

        if (phase === "HUNTER_SHOT" && myId === state.hunterShooterId && !isSelf && (p.alive !== false)){
          const b = document.createElement("button");
          b.className = "btn bad";
          b.textContent = "Tirer";
          b.onclick = () => send({ t:"hunterShot", targetId: p.id });
          right.appendChild(b);
        }
      }

      row.appendChild(left);
      row.appendChild(right);
      playersEl.appendChild(row);
    }
  }

  function connect(){
    if (ws && ws.readyState === 1) return;

    resetLocalState();
    renderTop();
    renderPlayers();
    renderActions();

    setConn(false, "Connexion‚Ä¶");
    ws = new WebSocket(WS_URL);

    ws.onopen = () => {
      setConn(true, "Connect√©");
      const nm = (nameEl.value || "Joueur").trim().slice(0, 18);
      send({ t:"join", name:nm });
    };

    ws.onmessage = (ev) => {
      let msg = null;
      try { msg = JSON.parse(ev.data); } catch(e) { return; }
      if (!msg || !msg.t) return;

      if (msg.t === "welcome"){
        myId = msg.id;
        isHost = !!msg.isHost;
        pushLog(`Bienvenue. Ton ID = ${myId}${isHost ? " (H√¥te)" : ""}`);
        renderTop();
      }

      if (msg.t === "lobby"){
        lobby = msg;
        state = null;
        setTimer(0);
        renderTop();
        renderSettings();
        renderPlayers();
        renderActions();
      }

      if (msg.t === "private"){
        if (msg.id === myId){
          myRole = msg.role || null;
          pushLog(`R√¥le re√ßu (priv√©) : ${myRole}`, true);
          renderTop();
          renderActions();
        }
      }

      if (msg.t === "state"){
        state = msg;
        setTimer(msg.endsInMs || 0);
        renderTop();
        renderPlayers();
        renderActions();
      }

      if (msg.t === "log"){
        pushLog(msg.text || "", !!msg.emph);
      }

      if (msg.t === "gameover"){
        pushLog(`FIN: ${msg.title} ‚Äî ${msg.sub}`, true);
      }
    };

    ws.onclose = () => {
      setConn(false, "D√©connect√©");
      pushLog("D√©connect√©.");
      ws = null;
      resetLocalState();
      renderTop();
      renderPlayers();
      renderActions();
    };

    ws.onerror = () => {
      setConn(false, "Erreur");
      pushLog("Erreur WebSocket. R√©essaie une fois.", true);
      renderTop();
      renderActions();
    };
  }

  function disconnect(){
    if (!ws) return;
    try { ws.close(); } catch(e) {}
  }

  // Boutons
  btnConnect.onclick = connect;
  btnDisconnect.onclick = disconnect;

  btnQuit.onclick = () => {
    if (ws && ws.readyState === 1) disconnect();
    window.location.href = "index.html";
  };

  btnReady.onclick = () => {
    if (!lobby || myId == null) return;
    const me = lobby.players.find(x => x.id === myId);
    const next = !(me && me.ready);
    send({ t:"ready", ready: next });
  };

  btnStart.onclick = () => send({ t:"start" });
  btnBackLobby.onclick = () => send({ t:"backToLobby" });

  btnApplySettings.onclick = () => {
    if (!lobby || !isHost || lobby.phase !== "LOBBY" || !lobby.allReady) return;
    send({
      t: "setSettings",
      wolvesCount: parseInt(setWolves.value, 10),
      hunterEnabled: (setHunter.value === "1"),
      revealS: parseInt(setReveal.value, 10),
      nightS: parseInt(setNight.value, 10),
      talkS: parseInt(setTalk.value, 10),
      voteS: parseInt(setVote.value, 10),
      hunterS: parseInt(setHunterTime.value, 10),
    });
  };

  btnDefaults.onclick = () => {
    setWolves.value = "1";
    setHunter.value = "1";
    setReveal.value = "12";
    setNight.value = "20";
    setTalk.value = "22";
    setVote.value = "20";
    setHunterTime.value = "15";
  };

  btnClearLog.onclick = () => { logEl.textContent = ""; };

  window.addEventListener("beforeunload", () => {
    try { if (ws) ws.close(); } catch(e) {}
  });

  setConn(false, "D√©connect√©");
  resetLocalState();
  renderTop();
  renderPlayers();
  renderActions();
})();
</script>
</body>
</html>
